<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Library</title>
</head>

<body>
  <header id="head" class="container">
    <div id='title'>
      <h1 class="title">library</h1>
      <p class="subtitle">
      <div id="count"></div>
      </p>
    </div>
    <div id="modal" class="modal">
      <form id="book-input">
        <label for="title">title</label></br>
        <input type='text' name="title" onKeyUp="formChanged()" onChange="formChanged()"><br>
        <label for="author">author</label></br>
        <input type='text' name="author" onKeyUp="formChanged()" onChange="formChanged()"><br>
        <label for="pages">pages</label></br>
        <input type='number' name="pages" onKeyUp="formChanged()" onChange="formChanged()"><br>
      </form>
      <div class="footer">
        <input type="button" onclick="addBook(), showModal(), updateCount()" value="submit">
      </div>
    </div>
    <form id="add-book">
      <input type="button" onclick="showModal()" value="add book">
    </form>
    <div id="head-right"></div>
  </header>
  <main id="main" class="container">
    <script>
      const myLibrary = [];
      var modal = document.getElementById("modal");
      var collection = document.getElementById("count");

      function showModal() {
        modal.classList.toggle('show');
      }

      
      function updateCount() {
        collection.innerHTML = "books: " + myLibrary.length;
      }

      updateCount();

      function Book(title, author, pages, read = false) {
        this.title = title;
        this.author = author;
        this.pages = pages;
        this.read = read;
        this.erase = function () {
          index = myLibrary.indexOf(this);
          myLibrary.splice(index);
          updateCount();
          let spine = document.getElementById(index);
          spine.remove();
        }
        this.toggleRead = function () {
          console.log(this);
          console.log(this.author);
          author = 'testing';
          console.log(this.author);
          console.log(this.read)
          if (this.read == false) {
            this.read = true;
            console.log(this.title + 'has been read');
          } else {
            this.read = false;
            console.log(this.title + 'has not been read');
          }
        }
        this.info = function () {
          console.log(this.title);
          console.log(this.author);
          console.log(this.read);
        }
      }

      function formChanged() {
        title = document.getElementsByName('title')[0].value;
        author = document.getElementsByName('author')[0].value;
        pages = document.getElementsByName('pages')[0].value;
      }

      function addBook() {
        var book = new Book(title, author, pages);
        myLibrary.push(book);
        drawNew();
      }


      function Card(book) {
        this.book = book;
        this.div = document.createElement('div');
        this.text = document.createElement('div');
        this.footer = document.createElement('div');
        this.footer.classList.add('footer');
        this.readBtn = document.createElement('input');
        this.deleteBtn = document.createElement('input');
        this.readBtn.type = 'button';
        this.readBtn.value = 'toggle read';
        this.deleteBtn.type = 'button';
        this.deleteBtn.value = 'remove book';
        this.readBtn.addEventListener('click', book.toggleRead.bind(book), false);
        this.deleteBtn.addEventListener('click', book.erase.bind(book), false);
        this.showCard = function () {
          this.div.classList.toggle('show');
          this.div.appendChild(this.text);
          this.div.appendChild(this.footer);
          this.footer.appendChild(this.readBtn);
          this.footer.appendChild(this.deleteBtn);
          this.text.innerHTML = "<p> Title: " + this.book.title + "</br>" +
            "Author: " + this.book.author + "</br>" +
            "Read: " + this.book.read + "</br>" +
            "Pages: " + this.book.pages + "</p>";
        }
      }

      function libInfo() {
        myLibrary.forEach(book => {
          book.info();
        })
      }

      function drawNew() {
        let index = myLibrary.length - 1;
        let book = myLibrary[index];
        const shelves = document.getElementById('shelves');
        let spine = document.createElement('div');
        spine.id = index;
        spine.classList.add('spine');
        let styleRoll = Math.random();
        if (styleRoll < .33) {
          spine.classList.add('first-style');
        } else if (styleRoll < .66) {
          spine.classList.add('second-style');
        } else {
          spine.classList.add('third-style');
        }
        let top = document.createElement('div');
        top.classList.add('top');
        let card = new Card(book);
        card.div.classList.add('modal');
        let bottom = document.createElement('div');
        bottom.classList.add('bottom');
        spine.appendChild(top);
        spine.appendChild(card.div);
        spine.addEventListener('click', card.showCard.bind(card), false);
        spine.appendChild(bottom);
        top.innerHTML = book.title;
        bottom.innerHTML = book.author;
        shelves.appendChild(spine);
      }

      function eraseLib() {
        document.querySelectorAll('.spine').forEach(item => {
          item.remove();
        })
      }

    </script>

    <div id="shelves"></div>

  </main>
</body>

</html>